<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HEB MCP · Connect H‑E‑B</title>
  <link rel="icon" href="/favicon.ico" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body class="bg-gradient-to-br from-[#fffdf9] to-bg text-ink min-h-screen p-4 md:p-8 font-['Inter',sans-serif]">
  <div class="max-w-[960px] mx-auto grid gap-6">
    <header class="flex items-center justify-between flex-wrap gap-3">
      <div>
        <div class="inline-block bg-accent-soft text-accent px-3 py-1 rounded-full font-semibold text-xs tracking-wider uppercase">HEB MCP</div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mt-2">Connect your H‑E‑B account</h1>
        <p class="text-muted text-lg mt-1">Link H‑E‑B once to enable shopping, cart, and pickup actions.</p>
      </div>
      <div id="statusBadge" class="bg-accent-soft text-accent px-3 py-1 rounded-full font-semibold text-xs tracking-wider uppercase">Checking status…</div>
    </header>

    <div class="bg-card rounded-[24px] border border-border-main p-6 md:p-8 shadow-xl shadow-black/5" id="clerkCard">
      <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
        <span class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center text-sm">0</span>
        Sign in to HEB MCP
      </h2>
      <p class="text-muted mb-6">We store your H‑E‑B tokens securely in your account so you can use HEB MCP from any client.</p>
      <div class="flex flex-wrap gap-3 items-center">
        <button class="bg-accent text-white px-6 py-2.5 rounded-full font-semibold shadow-lg shadow-accent/20 hover:scale-[1.02] active:scale-[0.98] transition-all cursor-pointer" id="clerkSignIn">Sign in</button>
        <button class="bg-transparent text-ink border border-border-main px-6 py-2.5 rounded-full font-semibold hover:bg-black/5 transition-all cursor-pointer hidden" id="clerkSignOut">Sign out</button>
        <span class="text-muted text-sm italic" id="clerkStatus">Checking sign-in…</span>
      </div>
      <div class="flex flex-wrap gap-3 items-center hidden mt-4" id="clerkLinkRow">
        <a class="bg-white text-accent border border-accent px-6 py-2.5 rounded-full font-semibold hover:bg-accent/5 transition-all" id="clerkSignInLink" target="_blank" rel="noopener">Open sign-in page</a>
        <span class="text-muted text-sm">Pop-up blocked? Use the link.</span>
      </div>
      <div class="grid hidden mt-6" id="clerkInlineWrap">
        <div id="clerkInline" class="min-h-[260px] rounded-2xl border border-dashed border-[#d7c8b3] bg-[#fffdf9] p-3"></div>
      </div>
      <p class="text-muted text-xs mt-4" id="clerkHint"></p>
    </div>

    <div class="bg-card rounded-[24px] border border-border-main p-6 md:p-8 shadow-xl shadow-black/5">
      <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
        <span class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center text-sm">1</span>
        Sign in with H‑E‑B
      </h2>
      <p class="text-muted mb-6">We’ll open the H‑E‑B mobile login in a new tab. Complete login and OTP, then return here.</p>
      <div class="flex flex-wrap gap-3 items-center">
        <button class="bg-accent text-white px-6 py-2.5 rounded-full font-semibold shadow-lg shadow-accent/20 hover:scale-[1.02] active:scale-[0.98] transition-all cursor-pointer" id="openAuth">Open H‑E‑B Login</button>
        <button class="bg-white text-accent border border-accent px-6 py-2.5 rounded-full font-semibold hover:bg-accent/5 transition-all cursor-pointer" id="copyAuth">Copy Login URL</button>
        <span class="text-muted text-xs" id="authHint"></span>
      </div>
    </div>

    <div class="bg-card rounded-[24px] border border-border-main p-6 md:p-8 shadow-xl shadow-black/5">
      <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
        <span class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center text-sm">2</span>
        Paste the redirect code
      </h2>
      <p class="text-muted mb-6">After login, your browser will attempt to open <code>com.heb.myheb://oauth2redirect</code>. Copy the full URL or just the <code>code</code> value and paste it below.</p>
      <div class="grid gap-4">
        <textarea id="codeInput" class="w-full px-4 py-3 rounded-xl border border-border-main text-sm font-mono min-h-[100px] focus:outline-none focus:ring-4 focus:ring-accent/10 focus:border-accent/50 transition-all bg-white" placeholder="Paste redirect URL or code here"></textarea>
        <div class="flex flex-wrap gap-3 items-center">
          <button class="bg-accent text-white px-6 py-2.5 rounded-full font-semibold shadow-lg shadow-accent/20 hover:scale-[1.02] active:scale-[0.98] transition-all cursor-pointer" id="exchangeBtn">Link H‑E‑B</button>
          <button class="bg-white text-accent border border-accent px-6 py-2.5 rounded-full font-semibold hover:bg-accent/5 transition-all cursor-pointer" id="pasteClipboard">Paste from clipboard</button>
          <span class="text-accent font-semibold text-sm" id="exchangeStatus"></span>
        </div>
        <details class="text-muted text-sm border border-dashed border-[#d7c8b3] rounded-xl p-3 bg-[#fffdf9]">
          <summary class="cursor-pointer font-bold select-none">Stuck on “Allow”? Here’s how to find the code.</summary>
          <p class="mt-2 leading-relaxed">After you click Allow, H‑E‑B responds with a redirect to <code>com.heb.myheb://oauth2redirect?code=…</code>. Some browsers hang when the app isn’t installed. Open the Network tab for the H‑E‑B login page and look for a <code>303</code> response with a <code>Location</code> header that starts with <code>com.heb.myheb://oauth2redirect</code>. Paste that URL or just the <code>code</code> value here.</p>
        </details>
      </div>
    </div>

    <div class="bg-card rounded-[24px] border border-border-main p-6 md:p-8 shadow-xl shadow-black/5">
      <h2 class="text-xl font-bold mb-2">Status</h2>
      <p id="statusText" class="text-muted mb-6">Checking…</p>
      <div class="flex gap-3">
        <button class="bg-white text-accent border border-accent px-6 py-2.5 rounded-full font-semibold hover:bg-accent/5 transition-all cursor-pointer" id="refreshStatus">Refresh status</button>
      </div>
    </div>
  </div>


  {{CONFIG_SCRIPT}}
  {{CLERK_SCRIPT}}
  <script src="/connect.js"></script>
</body>
</html>
